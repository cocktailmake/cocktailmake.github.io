#+OPTIONS: ^:nil
#+INCLUDE: ./org-macros.setup
#+BEGIN_COMMENT
.. title: Emacs modeline enhancement for Git diff
.. slug: emacs-modeline-enhancement-for-git-diff
.. date: 2020-08-12 23:56:24 UTC+09:00
.. tags: emacs, git
.. category: tool
.. link: 
.. description: 
.. type: text

#+END_COMMENT

Posted by Hitoshi Uchida

* Abstract

[[img-url:/images/emacs-modeline-enhancement-for-git-diff/vc.png]]


* Sample


[[img-url:/images/emacs-modeline-enhancement-for-git-diff/modeline.png]]


#+BEGIN_SRC
(defadvice vc-git-mode-line-string (after plus-minus (file) compile activate)
  "モードラインにgit diffの情報を表示する."
  (setq ad-return-value
        (concat (propertize ad-return-value 'face '(:foreground "white" :weight bold))
                " ["
                (let ((plus-minus (vc-git--run-command-string
                                   file "diff" "--numstat" "--")))
                  (if (and plus-minus
                       (string-match "^\\([0-9]+\\)\t\\([0-9]+\\)\t" plus-minus))
                       (concat
                        (propertize (format "+%s" (match-string 1 plus-minus)) 'face '(:foreground "green3"))
                        (propertize (format "-%s" (match-string 2 plus-minus)) 'face '(:inherit font-lock-warning-face)))
                    (propertize "✔" 'face '(:foreground "green3" :weight bold))))
                "]")))
#+END_SRC